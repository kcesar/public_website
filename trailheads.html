<!DOCTYPE html>
<html>
<title>King County Explorer Search & Rescue - Trailheads</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-green.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
<script src="siteassets/dropdown-fix.js" async="true"></script>
<script src="siteassets/locations.js"></script>

<style>
	.red {
		color: red;
	}

	.bold {
		font-weight: bold;
	}
</style>
<body>

<!-- Header -->
<header class="w3-theme" style="background-image: url(siteassets/staff_road.jpg); background-size: cover; background-position: center;" id="myHeader">
	<div class="w3-center" style="background-color:rgba(0, 0, 0, 0.5); padding: 64px 0;">
		<IMG SRC="siteassets/logo_esar.png" STYLE="height:200px; margin-bottom: 8px;">
		<H3>King County, WA</H3>
		<H4>Est. 1954</H4>
	</div>
</header>


<!-- Navigation -->
<nav id="navbar" class="w3-bar w3-theme"></nav>
<script src="./SiteAssets/nav.js"></script>

<!-- Body Wrapper -->
<div class="w3-row" style="max-width: 1200px; margin: auto;">
  
  <div class="w3-row-padding w3-margin-top">
		<div class="w3-container">
			<H3 style="font-weight: lighter; text-align: justify;">Members of King County Explorer Search and Rescue are often responding to missions at a common set of trailheads in our response area. Use the tools below to help find these trailheads.</H3>
		</div>	
	</div>
	
	<HR>

  <div class="w3-row-padding w3-margin-top">
		<div class="w3-container">      
      <p style="font-weight: bold;">Common Trailheads Map on SarTopo</p>
      <p>Want to explore common trailhead in SarTopo? We have a map for that!</p>
      <a class="w3-button w3-theme w3-round-xxlarge" style="bottom: 0; min-width: 225px;" href="https://sartopo.com/m/BRHA" target="_blank">sartopo.com/m/BRHA</a>

      <p style="font-weight: bold;">Phone Contacts CSV File</p>
      <p>Download the list of trailheads in a format that can easily be imported into your phone's contact list. See the <a href="/SiteAssets/trailheads-contacts.pdf">PDF instructions</a> for importing into your contact list.</p>
      <a class="w3-button w3-theme w3-round-xxlarge" style="bottom: 0; min-width: 225px;" href="/SiteAssets/trailheads.csv">Download CSV</a>

      <p style="font-weight: bold;">Google Earth KML File</p>
      <button class="w3-button w3-theme w3-round-xxlarge" style="bottom: 0; min-width: 225px;" onClick="generateKml(this)">Generate KML</button>
      <span id="kml-result"></span>
		</div>
  </div>
  <HR>

  <div class="w3-row-padding w3-margin-top">
    <div class="w3-container">
      <table class="w3-table w3-bordered w3-card-4" id="locationTable">
        <tr>
          <th class='w3-theme'>Location Name</th>
          <th class='w3-theme'>Short Link</th>
          <th class='w3-theme'>Coordinates</th>
        </tr>
      </table>
    </div>
  </div>
  <HR>

  <!-- Call to Action -->
  <div class="w3-row-padding w3-margin-top w3-margin-bottom">
  <div class="w3-container w3-center">
      
      <H3 style="font-weight: lighter">King County Explorer Search & Rescue (ESAR) is a 501(c)(3) Volunteer Organization.</H3>
      
      <P><STRONG>Our members respond to over 150 emergencies every year.</STRONG></P>

      <P style="text-align: justify;">ESAR is King County's primary wilderness ground search and rescue organization. Our members are outdoor enthusiasts with a passion for helping those in need. 100% of funding for training, operations, and critical, life-saving equipment comes from generous donations by local businesses, the communities that we serve, our volunteers, and people like you.<P>
      
      <form action="donate.html"><button type="submit" class="w3-button w3-yellow w3-round-xxlarge" style="bottom: 0;">Donate Today</button></form>
  </div>	
  </div>



</div>
<!-- End Body Wrapper -->

<!-- Footer -->
<footer class="w3-container w3-theme-dark w3-padding-16">
<div class="w3-row" style="max-width: 1200px; margin: auto;">
<div class="w3-mobile w3-left">
    <IMG SRC="siteassets/logo_esar.png" STYLE="height:50px; margin-right: 8px;">
    <span style="font-size: 1.5em;">King County Explorer Search & Rescue</span>
</div>		
<div class="w3-mobile" STYLE="clear: both; font-size:.75em; line-height: 40%;">
    <div class="w3-mobile w3-left">
        <p></p>© KCESAR • PO Box 1266 • North Bend, WA 98045</p>
        <p style="font-size:.75em;">Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
    </div>
    <div class="w3-mobile w3-right" STYLE="color: rgb(50, 121, 50);">
        <p><A HREF="about.html" style="text-decoration: none;">About KCESAR</A></p>
        <p><A HREF="contacts.html" style="text-decoration: none;">Contact Us</A></p>
        <p><A HREF="siteassets/KCESAR_Code_of_Conduct.pdf" style="text-decoration: none;">Code of Conduct</A></p>
    </div>
</div>
</div>
</footer>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.0.2/papaparse.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>

  function getData(callback) {
    Papa.parse("/SiteAssets/trailheads.csv", { download: true, header: true, complete: function(result) {
      console.log(result)
      callback.call(this,
        result.data.filter(function(row) { return row.Address }).map(function(row) {
          var coord = row.Address.split(',').map(function(coord) { return parseFloat(coord); })
          return Object.assign(row, { Lat: coord[0], Lng: coord[1] })
        })
      )}})
  }

function generateKml(triggerButton) {
  getData(function(data) {
    console.log(data);

    var text = '<?xml version="1.0" encoding="UTF-8"?><kml xmlns="http://www.opengis.net/kml/2.2"><Document><name>SAR Trailheads</name><Folder><name>Placemarks</name>\n';
    for (var i in data) {
      text += '<Placemark><name>' + data[i]['First Name'].replace('&', '&amp;') + '</name><description><![CDATA[' + data[i].Notes.replace('&', '&amp;') + ']]></description><Point><coordinates>' + data[i].Lng + ',' + data[i].Lat + '</coordinates></Point></Placemark>\n';
    }
    text += '</Folder></Document></kml>';
    var file = new Blob([text], {type: 'application/vnd.google-earth.kml+xml'});
    var url = window.URL.createObjectURL(file);

    $('#kml-result').html($('<a class="w3-button w3-theme w3-round-xxlarge" style="bottom: 0; margin-left:1em; min-width: 225px;">')
      .prop('href', url)
      .prop('download', 'trailheads.kml')
      .text("Download KML (" + data.length + " placemarks)"));
  });
}
</script>

<!-- Location Item Template -->
<template id="locationItem">
    <tr>
        <td></td>
        <td></td>
        <td style="font-family: Lucida Console, Courier, monospace;"></td>
    </tr>
</template>

<script>

  // Get Templates
  const LOCATION_ITEM = document.getElementById('locationItem'); // Course Session Template

  // Get the Table from the DOM
  let locationTable = document.getElementById('locationTable');

  // Add records to the Table
  if (locationTable != null) {
    for (i = 0; i < locationData.length; i++) {
      // Get Location Data
      let location = locationData[i];
      // Clone the Schedule Item template
      let newLocationItem = LOCATION_ITEM.content.cloneNode(true);
      // Populate template
      let td = newLocationItem.querySelectorAll('td');
      td[0].innerHTML = '<a href="https://www.google.com/maps/search/?api=1&query=' + location.Coordinates + '">' + location.FullName + '</a>';
      td[1].innerHTML = 'kcesar.org?map=' + location.LocName;
      td[2].innerHTML = location.Coordinates;
      // Add Course Session to schedule
      locationTable.appendChild(newLocationItem);
    }
  }
</script>

</body>
</html>